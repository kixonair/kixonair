<!doctype html>
<html lang="en">
<head>
<script>
(function(){
  var ok = ['kixonair.com','www.kixonair.com'];
  try {
    if (!ok.includes(location.hostname)) {
      location.replace('https://kixonair.com');
    }
  } catch(e){}
})();
</script>
<link rel="canonical" href="https://kixonair.com/"/>


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Kixonair — Match Center</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css?v=30" />
  <link rel="icon" href="/logo.svg" type="image/svg+xml" />
  <style>
    :root{ --pad: clamp(12px, 3vw, 22px); }
    .wrap{max-width:980px;margin:0 auto;padding:var(--pad)}
    .headerbar{display:grid;grid-template-columns:auto 1fr auto;align-items:center;margin-bottom:10px}
    .headerbar .center{justify-self:center;}
    .badge{display:inline-block;border:1px solid #2a2f37;border-radius:999px;padding:4px 10px;font-size:12px;max-width:50vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    /* TEAMS HERO */
    .teams{display:grid;grid-template-columns:1fr auto 1fr;gap:14px;align-items:center;justify-items:center;margin:10px 0 4px}
    .side{display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center}
    .side img{width:clamp(56px,14vw,84px);height:clamp(56px,14vw,84px);object-fit:contain}
    .teamName{font-size:clamp(16px,4.5vw,22px);font-weight:700;line-height:1.2;white-space:normal;overflow-wrap:anywhere}
    .h1{font-size:clamp(22px,8vw,34px);font-weight:900;text-align:center;letter-spacing:.06em}
    .muted{opacity:.78}
    .statusBig{margin-top:6px;margin-bottom:2px;text-align:center}
    /* Meta grid collapses gracefully */
    .meta{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin:14px 0}
    @media(max-width:720px){ .meta{grid-template-columns:repeat(2,minmax(0,1fr));} }
    /* Server buttons */
    .serverbar{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin:12px 0 4px; }
    .serverbar .sbtn{ display:inline-flex; align-items:center; justify-content:center; min-width:110px;
      border:1px solid #2a2f37; border-radius:12px; padding:10px 14px; text-decoration:none; color:#cbd5e1 }
    .serverbar .sbtn:hover{ background:#121821 }
    /* Loading overlay */
    .loading{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(3,8,14,.78);backdrop-filter:saturate(120%) blur(3px);z-index:50;transition:opacity .25s ease}
    .loading.hidden{opacity:0;pointer-events:none}
    .spinner{position:relative;width:74px;height:74px;margin-bottom:10px}
    .ring{position:absolute;inset:0;border-radius:50%;border:4px solid rgba(255,255,255,.14);border-top-color:rgba(255,255,255,.6);animation:spin 1s linear infinite}
    .dot{position:absolute;top:50%;left:50%;width:14px;height:14px;background:#22c55e;border-radius:50%;transform:translate(-50%,-50%);animation:pulse 1.2s ease-in-out infinite}
    .loadingText{font-size:14px;opacity:.9}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(.85);opacity:.85}50%{transform:translate(-50%,-50%) scale(1.12);opacity:1}}
    /* Hide league badge on narrow screens; full league is in meta */
    @media(max-width:600px){ #leagueBadge{display:none} }
  @media (max-width: 520px){
  .wrap{
    padding: 12px;
  }
  .headerbar{
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .teams .side img{
    width: 60px;
    height: 60px;
  }
  .teamName{
    font-size: 16px;
  }
  .serverbar{
    flex-wrap: nowrap;
    overflow-x: auto;
    gap: 10px;
  }
  .serverbar a{
    flex: 0 0 auto;
    white-space: nowrap;
  }
  .meta{
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>
<header class="header">
  <div class="bar">
    <a class="brand" href="/"><img src="/logo.svg" alt="Kixonair" height="28"/></a>
    <div style="flex:1"></div>
  </div>
</header>

<main class="wrap">
  <div id="loadingOverlay" class="loading" aria-live="polite" aria-busy="true">
    <div class="spinner"><div class="ring"></div><div class="dot"></div></div>
    <div class="loadingText">Loading match…</div>
  </div>

  <div class="headerbar">
    <a class="btn" href="/" aria-label="Back to schedule">← Back</a>
    <div class="center"></div>
    <span id="leagueBadge" class="badge"></span>
  </div>

  <div class="teams">
    <div class="side home"><img id="homeLogo" alt="" width="64" height="64" loading="lazy"/><span class="teamName" id="homeName"></span></div>
    <div class="h1" id="versus">VS</div>
    <div class="side away"><img id="awayLogo" alt="" width="64" height="64" loading="lazy"/><span class="teamName" id="awayName"></span></div>
  </div>
  <div class="muted statusBig" id="statusLine" style="text-align:center"></div>

  <div class="meta">
    <div><span class="muted small">Kickoff</span><div id="kickoff">-</div></div>
    <div><span class="muted small">Competition</span><div id="league">-</div></div>
    <div><span class="muted small">Status</span><div id="state">-</div></div>
  </div>

  <!-- Server buttons row -->
  <div id="serverBar" class="serverbar"></div>
</main>


<script>
  const $ = id => document.getElementById(id);

  function qs(name){ return new URLSearchParams(location.search).get(name) || ''; }
  function slug(s){ return String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
  function capWords(s){ return String(s||'').split(/[-\s]+/).map(w=>w?w[0].toUpperCase()+w.slice(1):'').join(' '); }
  function addDaysISO(iso, n){ const d = new Date(iso); d.setDate(d.getDate()+n); return d.toISOString().slice(0,10); }
  function isoToYMD(iso){ return iso.replace(/-/g,''); }

  function formatStatus(status){
    const raw = String(status || '').toUpperCase();
    const live = ['IN_PLAY','LIVE','PLAYING','1ST HALF','2ND HALF','FIRST HALF','SECOND HALF'];
    if (live.some(p=>raw.includes(p))) return 'Live';
    const half = ['HALF-TIME','HALFTIME','HT','PAUSED','BREAK'];
    if (half.some(p=>raw.includes(p))) return 'Half / Pause';
    const fin = ['FINISHED','FULL-TIME','FT','FINAL','ENDED','STATUS_FINAL'];
    if (fin.some(p=>raw.includes(p))) return 'Finished';
    const sched = ['SCHEDULED','NOT_STARTED','NS'];
    if (sched.some(p=>raw.includes(p))) return 'Scheduled';
    return status || '';
  }

  function renderServers(slugPart){
    const bar = $('serverBar') || $('servers');
    if (!bar) return;
    const url = '/stream_premium.html?id=' + encodeURIComponent(slugPart) + '&k=2e53b34da32e5044e25f26baddab45';
    const labels = ['Server 1','Server 2','Server 3','Server 4','Server 5'];
    bar.innerHTML = labels.map(l=>`<a href="${url}" target="_blank" rel="noopener">${l}</a>`).join('');
  }

  function matchSlug(sl, fx){
    const h = slug(fx.home?.name || '');
    const a = slug(fx.away?.name || '');
    return sl === `${h}-vs-${a}` || sl === `${a}-vs-${h}`;
  }

  async function fixturesFor(isoDate){
    const ymd = isoToYMD(isoDate);
    const urls = [
      `/fixtures.php?date=${ymd}`,
      `https://fotbal.site/fixtures.php?date=${ymd}`
    ];
    for (const u of urls){
      try{
        const r = await fetch(u, {cache:'no-store'});
        if (!r.ok) continue;
        const t = await r.text();
        let data;
        try { data = JSON.parse(t); } catch { continue; }
        if (Array.isArray(data)) return data;
        if (data && Array.isArray(data.fixtures)) return data.fixtures;
      }catch(e){}
    }
    return [];
  }

  function applyFixtureStatus(fx){
    const pretty = formatStatus(fx.status);
    $('state').textContent = pretty || '-';
    $('statusLine').textContent = pretty || '';
    $('kickoff').textContent = fx.start_utc ? new Date(fx.start_utc).toLocaleString() : '-';
  }

  function applyFixture(fx){
    const hn = fx.home?.name || 'Home';
    const an = fx.away?.name || 'Away';
    $('homeName').textContent = hn;
    $('awayName').textContent = an;
    $('homeLogo').src = fx.home?.logo || '/logo.svg';
    $('awayLogo').src = fx.away?.logo || '/logo.svg';
    $('league').textContent = fx.league?.name || '-';
    $('leagueBadge').textContent = fx.league?.name || '';
    applyFixtureStatus(fx);
    renderServers(slug(hn + '-vs-' + an));
  }

  function startStatusPoll(baseISO, slugPart){
    setInterval(async () => {
      const list = await fixturesFor(baseISO);
      const hit = list.find(fx => matchSlug(slugPart, fx));
      if (hit) applyFixtureStatus(hit);
    }, 25000);
  }

  async function load(){
    const raw = qs('id') || qs('m') || '';

    if (raw){
      const pure = raw.includes('@') ? raw.split('@')[0] : raw;
      const parts = pure.split('-vs-');
      if (parts.length === 2){
        $('homeName').textContent = capWords(parts[0]);
        $('awayName').textContent = capWords(parts[1]);
        renderServers(pure);
      } else {
        $('homeName').textContent = capWords(pure);
        renderServers(pure);
      }
    }

    const baseISO = raw.includes('@')
      ? raw.split('@')[1].replace(/(\d{4})(\d{2})(\d{2})/, '$1-$2-$3')
      : new Date().toISOString().slice(0,10);

    const slugPart = slug(raw.includes('@') ? raw.split('@')[0] : raw);

    const days = [-2,-1,0,1,2];
    let found = null;
    let foundDate = baseISO;

    for (const off of days){
      const iso = addDaysISO(baseISO, off);
      const list = await fixturesFor(iso);
      const hit = list.find(fx => matchSlug(slugPart, fx));
      if (hit){
        found = hit;
        foundDate = iso;
        break;
      }
    }

    if (found){
      applyFixture(found);
      startStatusPoll(foundDate, slugPart);
    }

    $('kx-loader').classList.add('hidden');
    $('page').style.display = 'block';
  }

  load();
</script>
</body>
</html>
