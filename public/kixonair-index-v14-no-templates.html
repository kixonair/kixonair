<!doctype html>
<html lang="en">
<head>
<script>
(function(){
  var ok = ['kixonair.com','www.kixonair.com'];
  try {
    if (!ok.includes(location.hostname)) {
      location.replace('https://kixonair.com');
    }
  } catch(e){}
})();
</script>
<link rel="canonical" href="https://kixonair.com/"/>


<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#0b0f14" />
<title>Kixonair ‚Äî Live Sports Schedule</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css?v=13" />
<!-- Use a relative path for the favicon to ensure it resolves when served locally or from file:// -->
<link rel="icon" href="/assets/logo.4e020dc4.svg" type="image/svg+xml" />
</head>
<body>
<header class="header">
  <div class="bar">
    <!-- Updated to use the new logo. The relative path ensures the image loads when opened via file protocol. -->
    <a class="brand brand--no-text" href="./"><img src="/assets/logo.4e020dc4.svg" alt="Kixonair" height="28"/></a>

    <div class="controls">
      <input id="q" type="text" placeholder="Search team‚Ä¶" aria-label="Search team"/>

      <div class="filters" role="tablist">
        <button class="pill active" data-sport="all">All</button>
        <button class="pill" data-sport="Football">Football</button>
        <button class="pill" data-sport="NBA">NBA</button>
        <button class="pill" data-sport="NFL">NFL</button>
      </div>

      <!-- Football league dropdown + Major toggle -->
      <div class="league-wrap" id="leagueWrap" hidden>
        <button class="pill" id="leagueToggle" aria-expanded="false" aria-controls="leagueMenu">Leagues ‚ñæ</button>
        <div class="league-menu hidden" id="leagueMenu" role="menu" aria-label="Choose league"></div>
        <span class="muted small" id="leagueChosen" style="margin-left:6px;"></span>
      </div>

      <label class="switch" title="Hide youth / reserves / friendlies">
        <input type="checkbox" id="majorOnly" checked>
        <span>Major only</span>
      </label>

      <div class="datepick">
        <input id="date" type="date" aria-label="Pick a date"/>
        <button id="today" class="ghost">Today</button>
        <button id="tomorrow" class="ghost">Tomorrow</button>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="hero">
    <h1>Today‚Äôs Games, Zero Noise.</h1>
    <p>Pick a game ‚Üí quick access ‚Üí match center.</p>
  </section>

  <div id="counts" class="counts">Loading‚Ä¶</div>

  <section class="grid" id="grid">
    <div class="section" data-sport="Football">
      <h2>‚öΩ Football</h2>
      <div id="football" class="list"></div>
    </div>
    <div class="section" data-sport="NBA">
      <h2>üèÄ NBA</h2>
      <div id="nba" class="list"></div>
    </div>
    <div class="section" data-sport="NFL">
      <h2>üèà NFL</h2>
      <div id="nfl" class="list"></div>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="inner">
    <span>¬© <span id="yy"></span> Kixonair</span>
    <span class="muted">Fixtures only ‚Äî no streams hosted.</span>
  </div>
</footer>

<script>
  document.getElementById('yy').textContent = new Date().getFullYear();

  // Utilities
  const fmtTime = d => new Date(d).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
  const pills = [].slice.call(document.querySelectorAll('.pill[data-sport]'));
  const grid = document.getElementById('grid');
  const leagueWrap = document.getElementById('leagueWrap');
  const leagueMenu = document.getElementById('leagueMenu');
  const leagueToggle = document.getElementById('leagueToggle');
  const leagueChosen = document.getElementById('leagueChosen');

  let activeSport = 'all';
  let leagueKey = 'all'; // active league within Football
  let ALL = []; // fixtures cache for the picked date

  // --- League definitions (robust across providers) ---
  function nameOf(fx){ return (fx.league && (fx.league.name || fx.league.code)) || ''; }
  function codeIs(fx, code){ return fx.league && (fx.league.code||'').toUpperCase() === code.toUpperCase(); }
  const LEAGUES = [
    { key:'all', label:'All Leagues', test: function(){ return true; } },
    { key:'ucl', label:'UEFA Champions League', test: fx => codeIs(fx,'CL') || /champions league/i.test(nameOf(fx)) },
    { key:'uel', label:'UEFA Europa League', test: fx => codeIs(fx,'EL') || /europa league/i.test(nameOf(fx)) },
    { key:'uecl', label:'UEFA Europa Conference League', test: fx => codeIs(fx,'ECL') || /conference league/i.test(nameOf(fx)) },
    { key:'pl',  label:'Premier League (England)', test: fx => codeIs(fx,'PL') || /premier league/i.test(nameOf(fx)) },
    { key:'laliga', label:'La Liga (Spain)', test: fx => codeIs(fx,'PD') || /(la\s*liga|primera division)/i.test(nameOf(fx)) },
    { key:'bundes', label:'Bundesliga (Germany)', test: fx => codeIs(fx,'BL1') || /bundesliga/i.test(nameOf(fx)) },
    { key:'seriea', label:'Serie A (Italy)', test: fx => codeIs(fx,'SA') || /serie\s*a/i.test(nameOf(fx)) },
    { key:'ligue1', label:'Ligue 1 (France)', test: fx => codeIs(fx,'FL1') || /ligue\s*1/i.test(nameOf(fx)) },
    { key:'eredivisie', label:'Eredivisie (Netherlands)', test: fx => /eredivisie/i.test(nameOf(fx)) },
    { key:'primeira', label:'Primeira Liga (Portugal)', test: fx => codeIs(fx,'PPL') || /(primeira liga|liga portugal|liga nos)/i.test(nameOf(fx)) },
    { key:'sco', label:'Scottish Premiership', test: fx => /(scottish premiership|premiership \(?scotland\)?)/i.test(nameOf(fx)) },
    { key:'bel', label:'Belgian Pro League', test: fx => /(jupiler|belgian pro league|pro league)/i.test(nameOf(fx)) },
    { key:'tur', label:'S√ºper Lig (Turkey)', test: fx => /(super lig|s√ºper lig)/i.test(nameOf(fx)) }
  ];

  // Build league menu WITHOUT template literals
  leagueMenu.innerHTML = LEAGUES.map(function(L){
    return '<button class="menuitem" role="menuitem" data-league="'+L.key+'">'+L.label+'</button>';
  }).join('');

  // Toggle dropdown
  leagueToggle.addEventListener('click', function(){
    var open = leagueToggle.getAttribute('aria-expanded') === 'true';
    leagueToggle.setAttribute('aria-expanded', String(!open));
    leagueMenu.classList.toggle('hidden', open);
  });
  // Close on outside click
  document.addEventListener('click', function(e){
    if (!leagueWrap.contains(e.target)) {
      leagueToggle.setAttribute('aria-expanded','false');
      leagueMenu.classList.add('hidden');
    }
  });
  // Choose league
  leagueMenu.addEventListener('click', function(e){
    var b = e.target.closest('button[data-league]'); if (!b) return;
    leagueKey = b.dataset.league;
    var found = LEAGUES.find(function(x){ return x.key===leagueKey; });
    leagueChosen.textContent = (found && found.label) ? found.label : '';
    leagueToggle.setAttribute('aria-expanded','false');
    leagueMenu.classList.add('hidden');
    renderLists();
  });

  // --- Minor (youth/reserves/friendlies) filters ---
  const MINOR_LEAGUE_PATTERNS = [
    /\bu\s?-?\s?(?:13|14|15|16|17|18|19|20|21|23)\b/i,
    /\b(youth|academy|primavera|reserves?)\b/i,
    /\b(friendly|friendlies|club friendly|pre[-\s]?season|amistoso|testspiel)\b/i,
    /\b(premier league 2|professional development league|u23 premier league)\b/i
  ];
  const MINOR_TEAM_PATTERNS = [
    /\bu\s?-?\s?(?:13|14|15|16|17|18|19|20|21|23)\b/i,
    /\b(reserves?)\b/i,
    /\b(ii|b)\b$/i,
    /\bacademy\b/i
  ];
  function isMinor(fx){
    const lname = ((fx.league && fx.league.name ? fx.league.name : '') + ' ' + (fx.league && fx.league.code ? fx.league.code : '')).toLowerCase();
    if (MINOR_LEAGUE_PATTERNS.some(function(rx){ return rx.test(lname); })) return true;
    const h = (fx.home && fx.home.name ? fx.home.name : '').toLowerCase();
    const a = (fx.away && fx.away.name ? fx.away.name : '').toLowerCase();
    return MINOR_TEAM_PATTERNS.some(function(rx){ return rx.test(h); }) || MINOR_TEAM_PATTERNS.some(function(rx){ return rx.test(a); });
  }
  const QS = new URLSearchParams(location.search);
  const majorOnlyEl = document.getElementById('majorOnly');
  if (QS.get('all') === '1') majorOnlyEl.checked = false;
  majorOnlyEl.addEventListener('change', function(){ renderLists(); });

  // Sport pills
  pills.forEach(function(p){
    p.addEventListener('click', function(){
      pills.forEach(function(x){ x.classList.remove('active'); });
      p.classList.add('active');
      activeSport = p.dataset.sport;
      leagueWrap.hidden = activeSport !== 'Football';
      renderVisibility();
    });
  });

  // Date controls
  const dateEl = document.getElementById('date');
  function ymd(ts){ const d = new Date(ts); d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); return d.toISOString().slice(0,10); }
  dateEl.value = ymd(Date.now());
  document.getElementById('today').onclick = function(){ dateEl.value = ymd(Date.now()); load(dateEl.value); };
  document.getElementById('tomorrow').onclick = function(){ dateEl.value = ymd(Date.now()+86400000); load(dateEl.value); };
  dateEl.addEventListener('change', function(){ load(dateEl.value); });

  // Search
  const q = document.getElementById('q');
  q.addEventListener('input', function(){ renderLists(); });

  // Card builder without template literals
  function card(fx){
    var a = document.createElement('a');
    a.className = 'item';
    a.dataset.sport = (fx.sport === 'Soccer') ? 'Football' : fx.sport;
    a.dataset.teams = (fx.home.name + ' ' + fx.away.name).toLowerCase();
    var s = slug(fx.home.name + '-vs-' + fx.away.name);
    a.href = '/go/' + fx.id + '?slug=' + encodeURIComponent(s);
    a.innerHTML =
      '<div class="time">'+ fmtTime(fx.start_utc) +'</div>' +
      '<div class="teams"><div class="h">'+ fx.home.name +'</div><div class="vs">vs</div><div class="a">'+ fx.away.name +'</div></div>' +
      '<div class="meta"><span class="league">'+ (fx.league && fx.league.name ? fx.league.name : '') +
      '</span><span class="status">'+ (fx.status || 'SCHEDULED') +'</span></div>';
    return a;
  }

  function skeleton(){ const d = document.createElement('div'); d.className='skeleton'; return d; }
  function setEmpty(el){ el.innerHTML = '<div class="empty">No games for this day.</div>'; }

  function renderVisibility(){
    const sections = [].slice.call(document.querySelectorAll('.section'));
    let visibleSections = [];
    sections.forEach(function(sec){
      const sport = sec.dataset.sport;
      const show = (activeSport==='all' || activeSport===sport);
      sec.style.display = show ? '' : 'none';
      if (show) visibleSections.push(sec);
    });
    grid.classList.toggle('single', visibleSections.length <= 1);
    sections.forEach(function(sec){ var lst = sec.querySelector('.list'); if (lst) lst.classList.remove('two-col'); });
    if (visibleSections.length === 1) {
      const list = visibleSections[0].querySelector('.list');
      if (list) list.classList.add('two-col');
    }
  }

  function renderLists(){
    const term = q.value.trim().toLowerCase();

    // Split fixtures
    const footballAll = ALL.filter(function(fx){ return fx.sport === 'Soccer'; });
    const nba = ALL.filter(function(fx){ return fx.sport === 'NBA'; });
    const nfl = ALL.filter(function(fx){ return fx.sport === 'NFL'; });

    // Apply league + major-only filter within Football
    const league = LEAGUES.find(function(x){ return x.key === leagueKey; }) || LEAGUES[0];
    const football = footballAll
      .filter(function(fx){ return league.test(fx); })
      .filter(function(fx){ return !majorOnlyEl.checked || !isMinor(fx); });

    // Fill helper
    function fill(arr, id){
      const el = document.getElementById(id);
      el.innerHTML='';
      if (!arr.length) { setEmpty(el); return; }
      let final = arr.slice();
      if (term) final = final.filter(function(fx){ return (fx.home.name + ' ' + fx.away.name).toLowerCase().includes(term); });
      final.sort(function(a,b){ return new Date(a.start_utc) - new Date(b.start_utc); })
           .forEach(function(fx){ el.appendChild(card(fx)); });
      if (!final.length) setEmpty(el);
    }

    fill(football, 'football');
    fill(nba, 'nba');
    fill(nfl, 'nfl');

    // Counts line
    document.getElementById('counts').textContent =
      'Loaded ' + football.length + ' ' + (leagueKey==='all' ? 'Football' : league.label) +
      ', ' + nba.length + ' NBA, ' + nfl.length + ' NFL for ' + dateEl.value;

    renderVisibility();
  }

  async function load(dateStr){
    ['football','nba','nfl'].forEach(function(id){
      const el = document.getElementById(id);
      el.innerHTML = ''; for (let i=0;i<4;i++) el.appendChild(skeleton());
    });
    try{
      const r = await fetch('/api/fixtures?date=' + dateStr);
      const j = await r.json();
      ALL = j.fixtures || [];
      renderLists();
    } catch(e){
      document.getElementById('counts').textContent = 'Could not load games. Try again shortly.';
      ['football','nba','nfl'].forEach(function(id){ setEmpty(document.getElementById(id)); });
    }
  }

  // Init
  leagueChosen.textContent = 'All Leagues';
  load(dateEl.value);
  leagueWrap.hidden = true; // show only when Football tab active
  pills.find(function(p){ return p.dataset.sport==='Football'; }).addEventListener('click', function(){ leagueWrap.hidden = false; });
</script>
</body>
</html>
