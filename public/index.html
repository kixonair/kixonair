<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#0b0f14" />
<title>Kixonair ‚Äî Live Sports Schedule</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css?v=21" />
<link rel="icon" href="/logo.svg" type="image/svg+xml" />
</head>
<body>
<header class="header">
  <div class="bar">
    <a class="brand" href="/"><img src="/logo.svg" alt="Kixonair" height="28"/></a>
    <div class="controls">
      <input id="q" type="text" placeholder="Search team‚Ä¶" aria-label="Search team"/>
      <div class="filters" role="tablist">
        <button class="pill active" data-sport="all">All</button>
        <button class="pill" data-sport="Football">Football</button>
        <button class="pill" data-sport="NBA">NBA</button>
        <button class="pill" data-sport="NFL">NFL</button>
      </div>
      <div class="league-wrap" id="leagueWrap">
        <button class="pill" id="leagueToggle" aria-expanded="false" aria-controls="leagueMenu">Leagues ‚ñæ</button>
        <div class="league-menu hidden" id="leagueMenu" role="menu" aria-label="Choose league"></div>
        <span class="muted small" id="leagueChosen" style="margin-left:6px;"></span>
      </div>
      <label class="switch" title="Hide youth / reserves / friendlies">
        <input type="checkbox" id="majorOnly"><span>Major only</span>
      </label>
      <div class="datepick">
        <input id="date" type="date" aria-label="Pick a date"/>
        <button id="today" class="ghost">Today</button>
        <button id="tomorrow" class="ghost">Tomorrow</button>
      </div>
    </div>
  </div>
</header>

<main>
  <section class="hero">
    <h1>Today‚Äôs Games, Zero Noise.</h1>
    <p>Pick a game ‚Üí quick access ‚Üí match center.</p>
  </section>

  <div id="counts" class="counts">Loading‚Ä¶</div>

  <section class="section" data-sport="Football">
    <h2>‚öΩ Football</h2>
    <div id="football" class="feed"></div>
  </section>

  <section class="section" data-sport="NBA">
    <h2>üèÄ NBA</h2>
    <div id="nba" class="feed"></div>
  </section>

  <section class="section" data-sport="NFL">
    <h2>üèà NFL</h2>
    <div id="nfl" class="feed"></div>
  </section>
</main>

<footer class="footer">
  <div class="inner">
    <span>¬© <span id="yy"></span> Kixonair</span>
    <span class="muted">Fixtures only ‚Äî no streams hosted.</span>
  </div>
</footer>

<script>
  document.getElementById('yy').textContent = new Date().getFullYear();
  const WATCH_URL = 'https://rileymarker.com/sportlo';
  const OPEN_IN_NEW_TAB = true;

  const fmtTime = d => new Date(d).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
  const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
  function norm(s){ return (s||'').toLowerCase().replace(/[^a-z0-9]+/g,' ').trim(); }
  const pills = [].slice.call(document.querySelectorAll('.pill[data-sport]'));
  const gridSections = [].slice.call(document.querySelectorAll('.section'));

  let activeSport = 'all';
  let leagueKey = 'all';
  let ALL = [];

  function nameOf(fx){ return (fx.league && (fx.league.name || fx.league.code)) || '';
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || ''; }
  function codeIs(fx, code){ return fx.league && (fx.league.code||'').toUpperCase() === code.toUpperCase(); }
  const LEAGUES = [
    { key:'all', label:'All Leagues', test: function(){ return true; } },
    { key:'ucl', label:'UEFA Champions League', test: fx => codeIs(fx,'CL') || /champions league/i.test(nameOf(fx)) },
    { key:'uel', label:'UEFA Europa League', test: fx => codeIs(fx,'EL') || /europa league/i.test(nameOf(fx)) },
    { key:'uecl', label:'UEFA Europa Conference League', test: fx => codeIs(fx,'ECL') || /conference league/i.test(nameOf(fx)) },
    { key:'pl',  label:'Premier League (England)', test: fx => codeIs(fx,'PL') || /premier league/i.test(nameOf(fx)) },
    { key:'laliga', label:'La Liga (Spain)', test: fx => codeIs(fx,'PD') || /(la\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s*liga|primera division)/i.test(nameOf(fx)) },
    { key:'bundes', label:'Bundesliga (Germany)', test: fx => codeIs(fx,'BL1') || /bundesliga/i.test(nameOf(fx)) },
    { key:'seriea', label:'Serie A (Italy)', test: fx => codeIs(fx,'SA') || /serie\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s*a/i.test(nameOf(fx)) },
    { key:'ligue1', label:'Ligue 1 (France)', test: fx => codeIs(fx,'FL1') || /ligue\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s*1/i.test(nameOf(fx)) }
  ];
  const leagueWrap = document.getElementById('leagueWrap');
  const leagueMenu = document.getElementById('leagueMenu');
  const leagueToggle = document.getElementById('leagueToggle');
  const leagueChosen = document.getElementById('leagueChosen');
  leagueMenu.innerHTML = LEAGUES.map(function(L){
    return '<button class="menuitem" role="menuitem" data-league="'+L.key+'">'+L.label+'</button>';
  }).join('');
  leagueChosen.textContent = 'All Leagues';
  leagueToggle.addEventListener('click', function(){
    var open = leagueToggle.getAttribute('aria-expanded') === 'true';
    leagueToggle.setAttribute('aria-expanded', String(!open));
    leagueMenu.classList.toggle('hidden', open);
  });
  document.addEventListener('click', function(e){
    if (!leagueWrap.contains(e.target)) {
      leagueToggle.setAttribute('aria-expanded','false');
      leagueMenu.classList.add('hidden');
    }
  });
  leagueMenu.addEventListener('click', function(e){
    var b = e.target.closest('button[data-league]'); if (!b) return;
    leagueKey = b.dataset.league;
    var found = LEAGUES.find(function(x){ return x.key===leagueKey; });
    leagueChosen.textContent = (found && found.label) ? found.label : '';
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';
    leagueToggle.setAttribute('aria-expanded','false');
    leagueMenu.classList.add('hidden');
    renderLists();
  });

  const MINOR_LEAGUE_PATTERNS = [
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';bu\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s?-?\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s?(?:13|14|15|16|17|18|19|20|21|23)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i,
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b(youth|academy|primavera|reserves?)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i,
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b(friendly|friendlies|club friendly|pre[-\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s]?season|amistoso|testspiel)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i,
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b(premier league 2|professional development league|u23 premier league)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i
  ];
  const MINOR_TEAM_PATTERNS = [
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';bu\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s?-?\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';s?(?:13|14|15|16|17|18|19|20|21|23)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i,
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b(reserves?)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i,
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b(ii|b)\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b$/i,
    /\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';bacademy\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';b/i
  ];
  function isMinor(fx){
    const lname = ((fx.league && fx.league.name ? fx.league.name : '') + ' ' + (fx.league && fx.league.code ? fx.league.code : '')).toLowerCase();
    if (MINOR_LEAGUE_PATTERNS.some(function(rx){ return rx.test(lname); })) return true;
    const h = (fx.home && fx.home.name ? fx.home.name : '').toLowerCase();
    const a = (fx.away && fx.away.name ? fx.away.name : '').toLowerCase();
    return MINOR_TEAM_PATTERNS.some(function(rx){ return rx.test(h); }) || MINOR_TEAM_PATTERNS.some(function(rx){ return rx.test(a); });
  }

  const QS = new URLSearchParams(location.search);
  const majorOnlyEl = document.getElementById('majorOnly');
  const savedMajor = localStorage.getItem('majorOnly');
  if (savedMajor !== null) majorOnlyEl.checked = savedMajor === '1';
  if (QS.get('all') === '1') majorOnlyEl.checked = false;
  majorOnlyEl.addEventListener('change', function(){
    localStorage.setItem('majorOnly', majorOnlyEl.checked ? '1' : '0');
    renderLists();
  });

  pills.forEach(function(p){
    p.addEventListener('click', function(){
      pills.forEach(function(x){ x.classList.remove('active'); });
      p.classList.add('active');
      activeSport = p.dataset.sport;
      renderVisibility();
    });
  });

  function renderVisibility(){
    gridSections.forEach(function(sec){
      var show = (activeSport==='all' || sec.dataset.sport === activeSport);
      sec.style.display = show ? '' : 'none';
    });
  }

  const dateEl = document.getElementById('date');
  function ymd(ts){ const d = new Date(ts); d.setMinutes(d.getMinutes() - d.getTimezoneOffset()); return d.toISOString().slice(0,10); }
  dateEl.value = ymd(Date.now());
  document.getElementById('today').onclick = function(){ dateEl.value = ymd(Date.now()); load(dateEl.value); };
  document.getElementById('tomorrow').onclick = function(){ dateEl.value = ymd(Date.now()+86400000); load(dateEl.value); };
  dateEl.addEventListener('change', function(){ load(dateEl.value); setTimeout(startScorePolling, 500); });

  const q = document.getElementById('q');
  q.addEventListener('input', function(){ renderLists(); });

  function imgTag(url, alt){
    return url ? '<img class="badge" src="'+url+'" alt="'+(alt||'')+'" onerror="this.style.display=\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';'none\
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';'"/>' : '';
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';
  }
  function statusLabel(fx){
    const st = (fx.status || '').toUpperCase();
    if (/LIVE|IN_PLAY|1ST|2ND/.test(st)) return 'LIVE';
    if (/FINISH|FT|ENDED/.test(st)) return 'FINISHED';
    return 'SCHEDULED';
  }
  function compName(fx){ return fx.league && (fx.league.name || fx.league.code) || '';
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || ''; }

  function card(fx){
  var a = document.createElement('div');
  a.className = 'game-card';
  // data attributes used by timers
  a.dataset.startUtc = fx.start_utc || '';
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || '';
  a.dataset.status = (fx.status || 'Scheduled');
  var s = slug((fx.home.name || '') + '-vs-' + (fx.away.name || ''));
  var watchHref = WATCH_URL + (WATCH_URL.indexOf('?') === -1 ? '?m=' : '&m=') + encodeURIComponent(s);
  a.innerHTML = [
    '<div class="gc-head">',
      '<div class="left">',
        '<span class="dot ' + (statusLabel(fx)==='LIVE'?'live':'') + '"></span>',
        '<span class="state ' + (statusLabel(fx)==='LIVE'?'live':(statusLabel(fx)==='Finished'?'finished':'scheduled')) + '">' + statusLabel(fx) + '</span>',
        '<div class="comp">' + ((fx.league && (fx.league.name||fx.league.code)) || '') + '</div>',
      '</div>',
      '<div class="sport-tag">' + ((fx.sport==='Soccer')?'Football':fx.sport) + '</div>',
    '</div>',
    '<div class="gc-main">',
      '<div class="team left">' + imgTag(fx.home.logo, fx.home.name) + '<span class="name">' + (fx.home.name||'') + '</span></div>',
      '<div class="score"><span class="num home-score">-</span><span class="sep"> - </span><span class="num away-score">-</span>',
        '<div class="when">' + fmtTime(fx.start_utc) + '</div>',
        '<div class="countdown"></div>',
      '</div>',
      '<div class="team right"><span class="name">' + (fx.away.name||'') + '</span>' + imgTag(fx.away.logo, fx.away.name) + '</div>',
    '</div>',
    '<div class="gc-foot"><a class="watch-btn' + (OPEN_IN_NEW_TAB?'" target="_blank"':'') + ' href="' + watchHref + '"><span class="play"></span>Watch Match</a></div>'
  ].join('');
  return a;
}

  function skeleton(){ const d = document.createElement('div'); d.className='game-card skeleton'; return d; }
  function setEmpty(el){ el.innerHTML = '<div class="empty">No games for this day.</div>'; }

  function renderLists(){
    const term = q.value.trim().toLowerCase();
    const footballAll = ALL.filter(function(fx){ return fx.sport === 'Soccer'; });
    const nba = ALL.filter(function(fx){ return fx.sport === 'NBA'; });
    const nfl = ALL.filter(function(fx){ return fx.sport === 'NFL'; });

    const league = LEAGUES.find(function(x){ return x.key === leagueKey; }) || LEAGUES[0];
    const footballPre = footballAll.filter(function(fx){ return league.test(fx); });
    const football = footballPre.filter(function(fx){ return !majorOnlyEl.checked || !isMinor(fx); });

    function fill(arr, id){
      const el = document.getElementById(id);
      el.innerHTML='';
      if (!arr.length) { setEmpty(el); return; }
      let final = arr.slice();
      if (term) final = final.filter(function(fx){ return (fx.home.name + ' ' + fx.away.name).toLowerCase().includes(term); });
      final.sort(function(a,b){ return new Date(a.start_utc) - new Date(b.start_utc); })
           .forEach(function(fx){ el.appendChild(card(fx)); });
      if (!final.length) setEmpty(el);
    }

    fill(football, 'football');
    fill(nba, 'nba');
    fill(nfl, 'nfl');

    document.getElementById('counts').textContent =
      'Loaded ' + football.length + ' Football (of ' + footballPre.length +
      (majorOnlyEl.checked ? ' after Major filter' : '') + '), ' +
      nba.length + ' NBA, ' + nfl.length + ' NFL for ' + dateEl.value;
    renderVisibility();
  }

  async function load(dateStr){
    ['football','nba','nfl'].forEach(function(id){
      const el = document.getElementById(id);
      el.innerHTML = '';
  a.dataset.home = norm(fx.home && fx.home.name);
  a.dataset.away = norm(fx.away && fx.away.name);
  a.dataset.start = fx.start_utc || ''; for (let i=0;i<3;i++) el.appendChild(skeleton());
    });
    try{
      const r = await fetch('/api/fixtures?date=' + dateStr);
      const j = await r.json();
      ALL = j.fixtures || [];
      renderLists();
      startScorePolling();
    }catch(e){
      document.getElementById('counts').textContent = 'Could not load games. Try again shortly.';
      ['football','nba','nfl'].forEach(function(id){ setEmpty(document.getElementById(id)); });
    }
  }

  load((function(){ const d = new Date(); d.setMinutes(d.getMinutes()-d.getTimezoneOffset()); return d.toISOString().slice(0,10); })());

// === Live score polling (client-side via ESPN) ============================
async function updateLiveScores(){
  const dateStr = dateEl.value;
  const yyyymmdd = dateStr.replace(/-/g,'');
  const endpoints = [
    ['soccer', 'https://site.api.espn.com/apis/site/v2/sports/soccer/scoreboard?dates='+yyyymmdd],
    ['nba',    'https://site.api.espn.com/apis/site/v2/sports/basketball/nba/scoreboard?dates='+yyyymmdd],
    ['nfl',    'https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard?dates='+yyyymmdd],
  ];
  const all = [];
  for (const [sport,url] of endpoints){
    try{
      const r = await fetch(url, {headers:{'Accept':'application/json'}});
      const j = await r.json();
      (j.events||[]).forEach(ev=>{
        const c = ev.competitions && ev.competitions[0];
        if(!c) return;
        const comps = c.competitors || [];
        const home = comps.find(x=>x.homeAway==='home') || comps[0] || {};
        const away = comps.find(x=>x.homeAway==='away') || comps[1] || {};
        const hname = (home.team && (home.team.shortDisplayName||home.team.abbreviation||home.team.name)) || home.displayName || '';
        const aname = (away.team && (away.team.shortDisplayName||away.team.abbreviation||away.team.name)) || away.displayName || '';
        const state = (ev.status && ev.status.type && ev.status.type.state) || (c.status && c.status.type && c.status.type.state) || '';
        all.push({
          sport,
          home: { name: hname, score: Number(home.score) },
          away: { name: aname, score: Number(away.score) },
          status: state,
          start: ev.date || c.date
        });
      });
    }catch(e){/* ignore */}
  }
  for (const fx of all){
    const sel = '.game-card[data-home="'+norm(fx.home.name)+'"][data-away="'+norm(fx.away.name)+'"]';
    document.querySelectorAll(sel).forEach(card=>{
      const hs = card.querySelector('.home-score');
      const as = card.querySelector('.away-score');
      if (hs && !Number.isNaN(fx.home.score)) hs.textContent = fx.home.score;
      if (as && !Number.isNaN(fx.away.score)) as.textContent = fx.away.score;
      const st = (fx.status||'').toUpperCase();
      const stateEl = card.querySelector('.state'); const dotEl = card.querySelector('.dot');
      if (/IN|LIVE/.test(st)){ stateEl.textContent='LIVE'; stateEl.classList.add('live'); stateEl.classList.remove('finished','scheduled'); if (dotEl) dotEl.classList.add('live'); }
      else if (/POST|FINAL|END/.test(st)){ stateEl.textContent='Finished'; stateEl.classList.add('finished'); stateEl.classList.remove('live','scheduled'); if (dotEl) dotEl.classList.remove('live'); }
    });
  }
}
function startScorePolling(){
  const today = new Date(Date.now() - new Date().getTimezoneOffset()*60000).toISOString().slice(0,10);
  const isToday = (dateEl && dateEl.value === today);
  if (!isToday) return;
  updateLiveScores();
  clearInterval(window.__scorePoll);
  window.__scorePoll = setInterval(updateLiveScores, 20000);
}

</script>
</body>
</html>
