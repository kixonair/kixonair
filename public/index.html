<!doctype html>
<html lang="en">
<head>
<script>
(function(){
  // Allow local development by whitelisting empty and local hostnames in addition to
  // the production domains.
  var ok = ['kixonair.com','www.kixonair.com','','localhost','127.0.0.1'];
  try {
    if (!ok.includes(location.hostname)) {
      location.replace('https://kixonair.com');
    }
  } catch(e){}
})();
</script>

<!-- this can stay, it won‚Äôt hurt -->
<script src="/secure-fetch.js"></script>

<link rel="canonical" href="https://kixonair.com/"/>

<meta name="theme-color" content="#0b0f14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kixonair ‚Äî Live Sports Schedule</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/styles.css?v=22" />
<link rel="icon" href="/logo.svg" type="image/svg+xml" />
<link rel="stylesheet" href="/scoreless.css">
</head>
<body>
<header class="header">
  <div class="bar">
    <a class="brand" href="/"><img src="/logo.svg" alt="Kixonair" height="28"/></a>
    <input id="q" type="text" placeholder="Search team‚Ä¶" aria-label="Search team"/>
    <button id="menuBtn" class="menu-btn" aria-label="Toggle menu">
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z" fill="currentColor"></path>
      </svg>
    </button>
    <div class="controls">
      <div class="filters" role="tablist">
        <button class="pill active" data-sport="all">All</button>
        <button class="pill" data-sport="Football">Football</button>
        <button class="pill" data-sport="NBA">NBA</button>
        <button class="pill" data-sport="NFL">NFL</button>
        <button class="pill" data-sport="NHL">NHL</button>
      </div>
      <div class="league-wrap" id="leagueWrap">
        <button class="pill" id="leagueToggle" aria-expanded="false" aria-controls="leagueMenu">Leagues ‚ñæ</button>
        <div class="league-menu hidden" id="leagueMenu" role="menu" aria-label="Choose league"></div>
        <span class="muted small" id="leagueChosen" style="margin-left:6px;"></span>
      </div>
      <label class="switch" title="Hide youth / reserves / friendlies">
        <input type="checkbox" id="majorOnly"><span>Major only</span>
      </label>
      <div class="datepick" style="display:none">
        <input id="date" type="date" aria-label="Pick a date"/>
        <button id="today" class="ghost">Today</button>
        <button id="tomorrow" class="ghost">Tomorrow</button>
      </div>
    </div>
    <div id="menuOverlay" class="menu-overlay"></div>
  </div>
</header>

<main>
  <section class="hero">
    <h1>Live Sports Streaming 24/7</h1>
  </section>

  <div id="counts" class="counts">Loading‚Ä¶</div>

  <section class="section" data-sport="Football">
    <h2>‚öΩ Football</h2>
    <div id="football" class="feed"></div>
  </section>

  <section class="section" data-sport="NBA">
    <h2>üèÄ NBA</h2>
    <div id="nba" class="feed"></div>
  </section>

  <section class="section" data-sport="NFL">
    <h2>üèà NFL</h2>
    <div id="nfl" class="feed"></div>
  </section>

  <section class="section" data-sport="NHL">
    <h2>üèí NHL</h2>
    <div id="nhl" class="feed"></div>
  </section>
</main>

<footer class="footer">
  <div class="inner">
    <span>¬© <span id="yy"></span> Kixonair</span>
    <span class="muted">Welcome to Kixonair.com, the best site for free live sports streaming. Watch NBA, NFL, UFC, F1, and MLB games in high quality without buffering. Enjoy smooth and reliable streams of your favorite sports online.</span>
  </div>
</footer>

<script>
  // ===== small helpers =====
  document.getElementById('yy').textContent = new Date().getFullYear();
  const WATCH_URL = '/watch.html';
  const OPEN_IN_NEW_TAB = true;
  const API_BASE = "https://fotbal.site/fixtures.php?date="; // üëà your Hostinger PHP

  const fmtTime = d => new Date(d).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', hour12:false});
  const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
  const pills = Array.from(document.querySelectorAll('.pill[data-sport]'));
  const gridSections = Array.from(document.querySelectorAll('.section'));

  let activeSport = 'all';
  let leagueKey = 'all';
  let ALL = [];

  // ===== leagues =====
  function nameOf(fx){ return (fx.league && (fx.league.name || fx.league.code)) || ''; }
  function codeIs(fx, code){ return fx.league && (fx.league.code||'').toUpperCase() === code.toUpperCase(); }

  const LEAGUES = [
    { key:'all', label:'All Leagues', test: () => true },
    { key:'ucl', label:'UEFA Champions League', test: fx => codeIs(fx,'CL') || /champions league/i.test(nameOf(fx)) },
    { key:'uel', label:'UEFA Europa League', test: fx => codeIs(fx,'EL') || /europa league/i.test(nameOf(fx)) },
    { key:'pl',  label:'Premier League (England)', test: fx => codeIs(fx,'PL') || /premier league/i.test(nameOf(fx)) },
    { key:'laliga', label:'La Liga (Spain)', test: fx => codeIs(fx,'PD') || /(la\s*liga|primera division)/i.test(nameOf(fx)) },
    { key:'bundes', label:'Bundesliga (Germany)', test: fx => codeIs(fx,'BL1') || /bundesliga/i.test(nameOf(fx)) },
    { key:'seriea', label:'Serie A (Italy)', test: fx => codeIs(fx,'SA') || /serie\s*a/i.test(nameOf(fx)) },
    { key:'ligue1', label:'Ligue 1 (France)', test: fx => codeIs(fx,'FL1') || /ligue\s*1/i.test(nameOf(fx)) }
  ];

  const leagueWrap = document.getElementById('leagueWrap');
  const leagueMenu = document.getElementById('leagueMenu');
  const leagueToggle = document.getElementById('leagueToggle');
  const leagueChosen = document.getElementById('leagueChosen');
  leagueMenu.innerHTML = LEAGUES.map(L => `<button class="menuitem" data-league="${L.key}">${L.label}</button>`).join('');
  leagueChosen.textContent = 'All Leagues';

  leagueToggle.addEventListener('click', () => {
    const open = leagueToggle.getAttribute('aria-expanded') === 'true';
    leagueToggle.setAttribute('aria-expanded', String(!open));
    leagueMenu.classList.toggle('hidden', open);
  });
  document.addEventListener('click', e => {
    if (!leagueWrap.contains(e.target)) {
      leagueToggle.setAttribute('aria-expanded','false');
      leagueMenu.classList.add('hidden');
    }
  });
  leagueMenu.addEventListener('click', e => {
    const b = e.target.closest('button[data-league]');
    if (!b) return;
    leagueKey = b.dataset.league;
    const found = LEAGUES.find(x => x.key === leagueKey);
    leagueChosen.textContent = found ? found.label : '';
    leagueToggle.setAttribute('aria-expanded','false');
    leagueMenu.classList.add('hidden');
    renderLists();
  });

  // ===== minor leagues filter =====
  const MINOR_LEAGUE_PATTERNS = [
    /\bu\s?-?\s?(?:13|14|15|16|17|18|19|20|21|23)\b/i,
    /\b(youth|academy|primavera|reserves?)\b/i,
    /\b(friendly|friendlies|club friendly|pre[-\s]?season|amistoso|testspiel)\b/i,
    /\b(premier league 2|professional development league|u23 premier league)\b/i
  ];
  const MINOR_TEAM_PATTERNS = [
    /\bu\s?-?\s?(?:13|14|15|16|17|18|19|20|21|23)\b/i,
    /\b(reserves?)\b/i,
    /\b(ii|b)\b$/i,
    /\bacademy\b/i
  ];
  function isMinor(fx){
    const lname = ((fx.league && fx.league.name ? fx.league.name : '') + ' ' + (fx.league && fx.league.code ? fx.league.code : '')).toLowerCase();
    if (MINOR_LEAGUE_PATTERNS.some(rx => rx.test(lname))) return true;
    const h = (fx.home && fx.home.name ? fx.home.name : '').toLowerCase();
    const a = (fx.away && fx.away.name ? fx.away.name : '').toLowerCase();
    return MINOR_TEAM_PATTERNS.some(rx => rx.test(h)) || MINOR_TEAM_PATTERNS.some(rx => rx.test(a));
  }

  // ===== favourites =====
  function getFavs(){
    try{
      return JSON.parse(localStorage.getItem('favourites') || '[]');
    }catch{ return []; }
  }
  function saveFavs(arr){
    try{ localStorage.setItem('favourites', JSON.stringify(arr)); }catch{}
  }
  function isFav(sl){
    return getFavs().includes(sl);
  }
  function toggleFav(sl){
    let f = getFavs();
    const i = f.indexOf(sl);
    if (i >= 0) f.splice(i,1); else f.push(sl);
    saveFavs(f);
    renderLists();
  }
  document.addEventListener('click', e => {
    if (e.target && e.target.classList.contains('fav')) {
      const card = e.target.closest('.game-card');
      if (!card) return;
      toggleFav(card.dataset.slug);
    }
  });

  // ===== sport tabs =====
  pills.forEach(p => {
    p.addEventListener('click', () => {
      pills.forEach(x => x.classList.remove('active'));
      p.classList.add('active');
      activeSport = p.dataset.sport;
      renderVisibility();
    });
  });

  function renderVisibility(){
    gridSections.forEach(sec => {
      const show = (activeSport === 'all' || sec.dataset.sport === activeSport);
      sec.style.display = show ? '' : 'none';
    });
  }

  // search
  const q = document.getElementById('q');
  q.addEventListener('input', () => renderLists());

  // mobile menu
  const menuBtn = document.getElementById('menuBtn');
  const controlsEl = document.querySelector('.controls');
  const menuOverlay = document.getElementById('menuOverlay');
  if (menuBtn && controlsEl && menuOverlay) {
    menuBtn.addEventListener('click', () => {
      const open = controlsEl.classList.toggle('open');
      menuOverlay.classList.toggle('active', open);
    });
    menuOverlay.addEventListener('click', () => {
      controlsEl.classList.remove('open');
      menuOverlay.classList.remove('active');
    });
  }

  function imgTag(url, alt){
    return url ? `<img class="badge" src="${url}" alt="${alt||''}" onerror="this.style.display='none'"/>` : '';
  }
  function statusLabel(fx){
    const st = (fx.status || '').toUpperCase();
    if (/\bHT\b/.test(st) || /HALF/.test(st)) return 'HALF';
    if (/LIVE|IN_PLAY|1ST|2ND/.test(st)) return 'LIVE';
    if (/STATUS_FINAL|STATUS_POSTGAME|POSTGAME|FINAL|FULL\s?TIME|FULLTIME|ENDED|FINISH(?:ED)?|\bFT\b/.test(st)) return 'FINISHED';
    return 'SCHEDULED';
  }
  function compName(fx){ return fx.league && (fx.league.name || fx.league.code) || ''; }

  function card(fx){
    const el = document.createElement('div');
    el.className = 'game-card';
    el.dataset.startUtc = fx.start_utc || '';
    el.dataset.status = statusLabel(fx);
    el.dataset.sport = fx.sport || '';
    const s = slug((fx.home.name||'') + '-vs-' + (fx.away.name||''));
    el.dataset.slug = s;
    const watchHref = WATCH_URL + '?id=' + encodeURIComponent(fx.id || s);

    el.innerHTML = `
      <div class="gc-head">
        <div class="left">
          <span class="dot ${statusLabel(fx)==='LIVE'?'live':''}"></span>
          <span class="state">${statusLabel(fx)}</span>
          <div class="comp">${compName(fx)}</div>
        </div>
        <span class="fav" title="Favourite">‚òÖ</span>
        <div class="sport-tag">${fx.sport === 'Soccer' ? 'Football' : fx.sport}</div>
      </div>
      <div class="gc-main">
        <div class="team left">${imgTag(fx.home.logo, fx.home.name)}<span class="name">${fx.home.name||''}</span></div>
        <div class="score">
          <span class="num" style="display:none">0</span>
          <span class="sep" style="display:none"> - </span>
          <span class="num" style="display:none">0</span>
          <div class="when">${fmtTime(fx.start_utc)}</div>
          <div class="countdown"></div>
        </div>
        <div class="team right"><span class="name">${fx.away.name||''}</span>${imgTag(fx.away.logo, fx.away.name)}</div>
      </div>
      <div class="gc-foot">
        <a class="watch-btn" ${OPEN_IN_NEW_TAB?'target="_blank"':''} href="${watchHref}">
          <span class="play"></span>Watch Match
        </a>
      </div>
    `;
    return el;
  }

  function skeleton(){
    const d = document.createElement('div');
    d.className = 'game-card skeleton';
    return d;
  }
  function setEmpty(el){
    el.innerHTML = '<div class="empty">No games.</div>';
  }

  function renderLists(){
    const term = q.value.trim().toLowerCase();
    const league = LEAGUES.find(x => x.key === leagueKey) || LEAGUES[0];

    const footballAll = ALL.filter(fx => fx.sport === 'Soccer');
    const nba = ALL.filter(fx => fx.sport === 'NBA');
    const nfl = ALL.filter(fx => fx.sport === 'NFL');
    const nhl = ALL.filter(fx => fx.sport === 'NHL');

    const footballPre = footballAll.filter(fx => league.test(fx));
    const football = footballPre.filter(fx => !(document.getElementById('majorOnly').checked) || !isMinor(fx));

    function fill(arr, id){
      const el = document.getElementById(id);
      el.innerHTML = '';
      if (!arr.length){ setEmpty(el); return; }

      let final = arr.slice();
      if (term){
        final = final.filter(fx => (fx.home.name + ' ' + fx.away.name).toLowerCase().includes(term));
      }

      final.sort((a,b) => {
        const sa = slug((a.home.name||'')+'-vs-'+(a.away.name||''));
        const sb = slug((b.home.name||'')+'-vs-'+(b.away.name||''));
        const fa = isFav(sa) ? 1 : 0;
        const fb = isFav(sb) ? 1 : 0;
        if (fa !== fb) return fb - fa;
        return (a.start_utc||'').localeCompare(b.start_utc||'');
      });

      final.forEach(fx => {
        const c = card(fx);
        if (isFav(c.dataset.slug)){
          c.classList.add('favourite');
          const star = c.querySelector('.fav');
          if (star) star.classList.add('active');
        }
        el.appendChild(c);
      });

      if (!final.length) setEmpty(el);
    }

    fill(football, 'football');
    fill(nba, 'nba');
    fill(nfl, 'nfl');
    fill(nhl, 'nhl');

    document.getElementById('counts').textContent =
      `Loaded ${football.length} Football (of ${footballPre.length}), ${nba.length} NBA, ${nfl.length} NFL, ${nhl.length} NHL (next 48h)`;
    renderVisibility();
  }

  // format YYYYMMDD
  function toYMD(ts){
    const d = new Date(ts);
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const da = String(d.getDate()).padStart(2,'0');
    return `${y}${m}${da}`;
  }

  // ===== main loader: use fotbal.site ONLY =====
  async function loadUpcoming(){
    ['football','nba','nfl','nhl'].forEach(id => {
      const el = document.getElementById(id);
      el.innerHTML = '';
      for (let i=0;i<3;i++) el.appendChild(skeleton());
    });

    const now = Date.now();
    const today = toYMD(now);
    const tomorrow = toYMD(now + 86400000);
    const yesterday = toYMD(now - 86400000); // keep late matches

    try {
      const [r1, r2, r3] = await Promise.all([
        fetch(API_BASE + yesterday),
        fetch(API_BASE + today),
        fetch(API_BASE + tomorrow)
      ]);
      const [j1, j2, j3] = await Promise.all([r1.json(), r2.json(), r3.json()]);

      let combined = [];
      if (j1 && j1.fixtures) combined = combined.concat(j1.fixtures);
      if (j2 && j2.fixtures) combined = combined.concat(j2.fixtures);
      if (j3 && j3.fixtures) combined = combined.concat(j3.fixtures);

      const H48 = 48*60*60*1000;
      const past = 6*60*60*1000;
      const filtered = combined.filter(fx => {
        const ts = Date.parse(fx.start_utc);
        if (!isFinite(ts)) return false;
        const diff = ts - now;
        return diff < H48 && diff > -past;
      });

      filtered.sort((a,b) => (a.start_utc||'').localeCompare(b.start_utc||''));

      ALL = filtered;
      renderLists();

    } catch (e) {
      document.getElementById('counts').textContent = 'Could not load fixtures from fotbal.site';
      ['football','nba','nfl','nhl'].forEach(id => setEmpty(document.getElementById(id)));
    }
  }

  // ===== periodic status refresh (also fotbal.site) =====
  async function refreshStatuses(){
    try {
      const today = toYMD(Date.now());
      const r = await fetch(API_BASE + today + '&_=' + Date.now());
      if (!r.ok) return;
      const j = await r.json();
      const list = j && j.fixtures ? j.fixtures : [];
      list.forEach(fx => {
        const s = slug((fx.home.name||'') + '-vs-' + (fx.away.name||''));
        const cards = document.querySelectorAll('.game-card[data-slug="'+s+'"]');
        const st = statusLabel(fx);
        cards.forEach(card => {
          card.dataset.status = st;
          const stateEl = card.querySelector('.state');
          const dot = card.querySelector('.dot');
          if (stateEl){
            stateEl.textContent = st;
            stateEl.classList.remove('live','half','scheduled','finished');
            if (st==='LIVE') stateEl.classList.add('live');
            else if (st==='HALF') stateEl.classList.add('half');
            else if (st==='FINISHED') stateEl.classList.add('finished');
            else stateEl.classList.add('scheduled');
          }
          if (dot){
            dot.classList.remove('live');
            if (st==='LIVE') dot.classList.add('live');
          }
        });
      });
    } catch (e) {
      // ignore
    }
  }

  // timer to update countdowns
  (function(){
    const H=3600*1000, M=60*1000, S=1000;
    const pad = n => String(n).padStart(2,'0');
    const fmtCountdown = ms => {
      if (ms < 0) ms = 0;
      const h = Math.floor(ms/H),
            m = Math.floor((ms%H)/M),
            s = Math.floor((ms%M)/S);
      return pad(h)+':'+pad(m)+':'+pad(s);
    };
    function updateCard(el){
      const iso = el.dataset.startUtc || '';
      if (!iso) return;
      const start = Date.parse(iso);
      if (!isFinite(start)) return;
      const now = Date.now();
      const diff = start - now;
      const dot = el.querySelector('.dot');
      const state = el.querySelector('.state');
      const when = el.querySelector('.when');
      const cd = el.querySelector('.countdown');
      if (when) when.textContent = fmtTime(iso);

      let st = String(el.dataset.status || '').toUpperCase();
      if (!st || st==='SCHEDULED'){
        const sport = (el.dataset.sport || '').toUpperCase();
        let fallbackHours = 4;
        if (sport === 'SOCCER' || sport === 'FOOTBALL') fallbackHours = 2;
        else if (sport === 'NBA') fallbackHours = 3;
        else if (sport === 'NFL') fallbackHours = 4;
        const fallbackMs = fallbackHours * H;
        if (diff <= 0 && diff > -fallbackMs) {
          st = 'LIVE';
        } else if (diff <= -fallbackMs) {
          st = 'FINISHED';
        } else {
          st = 'SCHEDULED';
        }
      }

      if (st === 'SCHEDULED'){
        if (cd){ cd.textContent = 'Starts in '+fmtCountdown(diff); cd.style.display='block'; }
        if (state){ state.textContent='SCHEDULED'; state.classList.remove('live','finished','half'); state.classList.add('scheduled'); }
        if (dot) dot.classList.remove('live');
      } else if (st === 'HALF'){
        if (cd) cd.style.display='none';
        if (state){ state.textContent='HALF'; state.classList.remove('live','finished','scheduled'); state.classList.add('half'); }
        if (dot) dot.classList.add('live');
      } else if (st === 'LIVE'){
        if (cd) cd.style.display='none';
        if (state){ state.textContent='LIVE'; state.classList.remove('finished','scheduled','half'); state.classList.add('live'); }
        if (dot) dot.classList.add('live');
      } else {
        if (cd) cd.style.display='none';
        if (state){ state.textContent='FINISHED'; state.classList.remove('live','scheduled','half'); state.classList.add('finished'); }
        if (dot) dot.classList.remove('live');
      }
    }
    function tick(){
      document.querySelectorAll('.game-card').forEach(updateCard);
    }
    setInterval(tick, 1000);
  })();

  // initial load + intervals
  loadUpcoming();
  setInterval(loadUpcoming, 15 * 60 * 1000);  // refresh list
  setInterval(refreshStatuses, 30 * 1000);    // refresh status only
</script>
</body>
</html>
