<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kixonair — Minimal Live Player</title>

  <!-- Anti-FOUC -->
  <script>document.documentElement.classList.add('fouc-hide');</script>

  <!-- Fonts / Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Material+Symbols+Rounded:wght@400;500&display=swap" rel="stylesheet">

  <!-- Tailwind (for any utility classes you use) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ===== Anti-FOUC + small preloader ===== */
    .fouc-hide body{visibility:hidden}
    .kix-preloader{position:fixed;inset:0;z-index:2147483000;display:grid;place-items:center;background:
      radial-gradient(120% 120% at 50% 30%, #0a1020 0%, #060b13 70%, #050912 100%);color:#f5f6fa;
      transition:opacity .45s ease,visibility .45s ease}
    .kix-preloader.hide{opacity:0;visibility:hidden}
    .kix-pre-card{border:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg,#101a2e,#0b1424);
      border-radius:16px;padding:18px 20px;min-width:min(92vw,360px);box-shadow:0 24px 80px rgba(0,0,0,.55),
      inset 0 0 0 1px rgba(255,255,255,.03);text-align:center}
    .kix-pre-title{font-weight:700;letter-spacing:.2px;margin-bottom:8px}
    .kix-pre-row{display:flex;align-items:center;justify-content:center;gap:12px;margin:12px 0}
    .kix-pre-spinner{width:40px;height:40px;border-radius:50%;border:3px solid rgba(255,255,255,.18);border-top-color:#fff;animation:kixSpin 1s linear infinite}
    @keyframes kixSpin{to{transform:rotate(360deg)}}

    :root{
      --bg:#070c18; --bg2:#0a1224; --text:#e7ebf3; --muted:#92a0b6; --live:#ef4444;
      --card:#0f172a; --card-2:#0b1324; --border:rgba(255,255,255,.08); --radius:20px;
      --violet-2:#7c3aed; --violet-3:#8b5cf6; --accent:#7c3aed; --accent-2:#8b5cf6;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(140% 120% at 50% -10%, var(--bg2), var(--bg));color:var(--text);font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;overflow-x:hidden}
    body::before{content:"";position:fixed;inset:0;background:repeating-linear-gradient(45deg, rgba(255,255,255,.02) 0 2px, transparent 2px 7px);pointer-events:none;opacity:.25}

    /* Fade-in for content once loaded */
    .wrap{max-width:1060px;margin:24px auto 48px;padding:0 14px;opacity:0;transform:translateY(6px);transition:opacity .35s ease, transform .35s ease}
    .wrap.revealed{opacity:1;transform:none}

    .pageLogo{display:block;margin:6px 8px 14px 8px;}
    .pageLogo img{height:48px;width:auto;vertical-align:middle}

    .playerCard{position:relative;border-radius:var(--radius);overflow:hidden;box-shadow:0 28px 80px rgba(0,0,0,.55);border:1px solid var(--border);background:
      radial-gradient(90% 70% at 50% 0%, rgba(124,58,237,.12), transparent 40%),
      linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0) 35%),
      linear-gradient(180deg, var(--card), var(--card-2));}

    .player{position:relative;aspect-ratio:16/9;display:grid;place-items:center;transition:background-color .2s ease}
    .poster{position:absolute;inset:0;background:
      radial-gradient(70% 50% at 50% 0%, rgba(124,58,237,.14), transparent 40%),
      repeating-linear-gradient(135deg, rgba(255,255,255,.04) 0 2px, transparent 2px 10px);
      filter:saturate(.95) brightness(.95);transition:opacity .2s ease}
    /* ⬇️ Blackout state after click */
    .player.blackout{background:#000;}
    .player.blackout .poster{opacity:0;}

    .poster::after{content:"";position:absolute;inset:0;background:
      radial-gradient(120% 160% at 50% 50%, rgba(0,0,0,.1), rgba(0,0,0,.25)),
      url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="60" viewBox="0 0 120 60"><defs><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter></defs><rect width="120" height="60" filter="url(%23n)" opacity="0.06"/></svg>');
      mix-blend-mode:overlay; animation:kixNoise 6s linear infinite;}
    @keyframes kixNoise{0%{transform:translate(0,0)}50%{transform:translate(-1%,1%)}100%{transform:translate(0,0)}}

    .liveBar{position:absolute;inset:12px 12px auto 12px;display:flex;align-items:center;gap:10px;justify-content:space-between;z-index:3}
    .liveLeft{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,.42);border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;backdrop-filter:blur(6px)}
    .liveDot{width:9px;height:9px;border-radius:50%;background:var(--live);box-shadow:0 0 0 0 rgba(255,59,48,.7);animation:kixPulse 1.4s infinite}
    .liveText{font-weight:800;letter-spacing:.3px;font-size:12px}
    .watching{display:flex;align-items:center;gap:8px;background:rgba(0,0,0,.42);border:1px solid rgba(255,255,255,.08);padding:6px 10px;border-radius:999px;font-size:12px}
    .watching b{font-weight:800}
    @keyframes kixPulse{0%{box-shadow:0 0 0 0 rgba(255,59,48,.6)}70%{box-shadow:0 0 0 12px rgba(255,59,48,0)}100%{box-shadow:0 0 0 0 rgba(255,59,48,0)}}

    /* Overlay with robust centering and reliable clicks */
    .overlay{position:absolute;inset:0;z-index:4;background:linear-gradient(180deg,rgba(0,0,0,.18),rgba(0,0,0,.55) 65%, rgba(0,0,0,0) 100%);pointer-events:none}
    .overlayCenter{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;gap:12px;pointer-events:auto}
    .playBtn{width:76px;height:76px;border-radius:50%;border:1px solid rgba(255,255,255,.08);display:grid;place-items:center;cursor:pointer;color:white;background:radial-gradient(120% 120% at 30% 20%, var(--violet-3), var(--violet-2));box-shadow:0 16px 34px rgba(124,58,237,.38);transition:transform .12s ease}
    .playBtn:hover{transform:scale(1.03)}
    .playBtn:active{transform:scale(0.98)}
    .hint{color:#8c96aa;font-size:12px}

    /* --- Starting Soon overlay --- */
    .startingSoon{position:absolute;inset:0;z-index:5;display:grid;place-items:center;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.72));}
    .soonCard{border:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,#101a2e,#0b1424);border-radius:16px;padding:16px 18px;min-width:min(92vw,360px);box-shadow:0 24px 80px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.03);text-align:center}
    .soonTitle{font-weight:800;letter-spacing:.2px;margin-bottom:4px}
    .soonMsg{color:#c9d4ea;font-size:13px;margin-bottom:10px;min-height:18px}
    .soonCountdown{font-size:28px;font-weight:800;margin:4px 0 10px}
    .soonBar{height:8px;border-radius:999px;background:#0c1425;border:1px solid #1d2a42;overflow:hidden}
    .soonFill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2));}

    .playerBoot{position:absolute;inset:0;z-index:6;display:grid;place-items:center;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.5));}
    .bootCard{border:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg,#101a2e,#0b1424);border-radius:16px;padding:14px 16px;min-width:220px;box-shadow:0 24px 80px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.03);text-align:center;color:#f5f6fa}
    .bootTitle{font-weight:700;letter-spacing:.2px;margin-bottom:8px;font-size:14px}
    .bootRow{display:flex;align-items:center;justify-content:center;gap:10px}
    .bootSpinner{width:34px;height:34px;border-radius:50%;border:3px solid rgba(255,255,255,.18);border-top-color:#fff;animation:kixSpin 1s linear infinite}

    .loadingWrap{position:absolute;inset:0;z-index:6;display:grid;place-items:center;gap:10px;background:linear-gradient(180deg,rgba(0,0,0,.15),rgba(0,0,0,.45));transition:opacity .2s ease}
    .spinner{width:44px;height:44px;border-radius:50%;border:3px solid rgba(255,255,255,.18);border-top-color:#fff;animation:kixSpin 1s linear infinite}
    .status{font-size:13px;color:#d7def1}

    .hidden{display:none!important}

    .controls{position:relative;z-index:3;margin:10px 12px 14px;display:flex;align-items:center;gap:10px;padding:8px;background:rgba(8,12,22,.6);backdrop-filter:blur(6px);border:1px solid var(--border);border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.45)}
    .controls.prestart{opacity:.95;pointer-events:none;filter:saturate(.85)}
    .cluster{display:flex;align-items:center;gap:8px}
    .iconBtn{display:grid;place-items:center;width:40px;height:40px;border-radius:10px;background:#111c2e;border:1px solid rgba(255,255,255,.06);color:#eef2f9;cursor:pointer}
    .progress{position:relative;flex:1;height:10px;border-radius:999px;background:#0c1425;border:1px solid #1d2a42;overflow:hidden}
    .progressBuffered{position:absolute;inset:0;height:100%;background:linear-gradient(90deg,rgba(255,255,255,.18),rgba(255,255,255,.08));width:0}
    .progressFill{position:absolute;inset:0;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0}
    .thumb{position:absolute;top:50%;transform:translate(-50%,-50%);width:14px;height:14px;border-radius:50%;background:#fff;box-shadow:0 0 0 3px rgba(255,255,255,.25);left:0}
    .tooltip{position:absolute;bottom:100%;transform:translateX(-50%);padding:4px 6px;background:#0f172a;color:#e2e8f0;border:1px solid #243045;border-radius:6px;font-size:11px;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s ease}
  </style>
</head>
<body>
  <!-- Tiny preloader -->
  <div id="preloader" class="kix-preloader" role="status" aria-live="polite" aria-busy="true">
    <div class="kix-pre-card">
      <div class="kix-pre-title">Loading experience…</div>
      <div class="kix-pre-row"><div class="kix-pre-spinner" aria-hidden="true"></div></div>
      <div class="kix-pre-sub">Just a moment</div>
    </div>
  </div>

  <div class="wrap" id="app">
    <!-- Logo (left-aligned) -->
    <div class="pageLogo">
      <img src="https://kixonair.com/logo.svg" alt="Kixonair logo">
    </div>

    <div class="playerCard" id="playerCard">
      <!-- Top live bar -->
      <div class="liveBar">
        <div class="liveLeft"><span class="liveDot" aria-hidden="true"></span><span class="liveText">LIVE</span></div>
        <div class="watching" aria-live="polite" aria-atomic="true">
          <span class="material-symbols-rounded" style="font-size:16px" aria-hidden="true">visibility</span>
          <span><b id="watchingCount">0</b> watching</span>
        </div>
      </div>

      <div class="player" id="player">
        <div class="poster" aria-hidden="true"></div>

        <!-- Starting Soon slate -->
        <div id="startingSoon" class="startingSoon hidden" role="status" aria-live="polite">
          <div class="soonCard">
            <div class="soonTitle">Stream is about to begin</div>
            <div id="soonMsg" class="soonMsg">Preparing stream…</div>
            <div class="soonCountdown"><span id="soonCount">3</span>s</div>
            <div class="soonBar"><div id="soonFill" class="soonFill"></div></div>
          </div>
        </div>

        <!-- Mini player boot loader -->
        <div id="playerBoot" class="playerBoot" role="status" aria-live="polite" aria-busy="true">
          <div class="bootCard">
            <div class="bootTitle">Player is loading…</div>
            <div class="bootRow"><div class="bootSpinner" aria-hidden="true"></div></div>
          </div>
        </div>

        <!-- Play overlay -->
        <div class="overlay hidden" id="overlay">
          <div class="overlayCenter" id="overlayCenter">
            <button class="playBtn" id="playBtn" aria-label="Play">
              <span class="material-symbols-rounded" aria-hidden="true" style="font-size:28px">play_arrow</span>
            </button>
          </div>
        </div>

        <!-- “Connecting / Buffering” -->
        <div class="loadingWrap hidden" id="loading" aria-live="polite" aria-busy="false">
          <div class="spinner" aria-hidden="true"></div>
          <div class="status" id="status">Connecting…</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls prestart" id="controls" role="group" aria-label="Player controls">
        <div class="cluster left">
          <button class="iconBtn" id="ctrlRew" title="Back 10s" aria-label="Back 10 seconds"><span class="material-symbols-rounded">replay_10</span></button>
          <button class="iconBtn" id="ctrlPlay" title="Play/Pause" aria-label="Play/Pause"><span class="material-symbols-rounded">play_arrow</span></button>
          <button class="iconBtn" id="ctrlFwd" title="Forward 10s" aria-label="Forward 10 seconds"><span class="material-symbols-rounded">forward_10</span></button>
        </div>

        <div class="progress" id="progress" role="slider" aria-label="Seek" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="progressBuffered" id="progressBuffered"></div>
          <div class="progressFill" id="progressFill"></div>
          <div class="thumb" id="thumb"></div>
          <div class="tooltip" id="seekTip">00:00</div>
        </div>

        <div class="cluster right">
          <button class="iconBtn" id="fullscreen" title="Fullscreen" aria-label="Fullscreen"><span class="material-symbols-rounded">fullscreen</span></button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // === Reveal app once everything is loaded (Anti-FOUC exit) ===
    window.addEventListener('load', function(){
      const pre = document.getElementById('preloader');
      const app = document.getElementById('app');
      if (pre){ pre.classList.add('hide'); }
      document.documentElement.classList.remove('fouc-hide');
      if (app){ app.classList.add('revealed'); }
    });

    // === Fix iOS/Safari "Back" issue: force reload when coming from bfcache ===
    window.addEventListener('pageshow', function (event) {
      if (event.persisted) {
        window.location.reload();
      }
    });

    function pad2(n){ return (n<10?'0':'')+n; }
    function formatTime(s){
      const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=Math.floor(s%60);
      return h>0?`${pad2(h)}:${pad2(m)}:${pad2(sec)}`:`${pad2(m)}:${pad2(sec)}`;
    }
    function formatInt(x){ return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

    // Live counter
    (function(){
      const el = document.getElementById('watchingCount');
      let n = Math.floor(12000 + Math.random()*34000);
      const min = 5000, max = 120000;
      function tick(){
        const upBias = Math.random() < 0.62 ? 1 : -1;
        const delta = Math.floor((50 + Math.random()*170) * upBias);
        n = Math.max(min, Math.min(max, n + delta));
        el.textContent = formatInt(n);
        setTimeout(tick, 800 + Math.random()*1800);
      }
      el.textContent = formatInt(n);
      tick();
    })();

    // ==== FAKE STREAM ENGINE with "Starting Soon" & buffering ==== 
    (function(){
      const overlay = document.getElementById('overlay');
      const overlayCenter = document.getElementById('overlayCenter');
      const loading = document.getElementById('loading');
      const status = document.getElementById('status');
      const controls = document.getElementById('controls');
      const ctrlPlay = document.getElementById('ctrlPlay');
      const playBtn = document.getElementById('playBtn');
      const progress = document.getElementById('progress');
      const progressFill = document.getElementById('progressFill');
      const progressBuffered = document.getElementById('progressBuffered');
      const thumb = document.getElementById('thumb');
      const seekTip = document.getElementById('seekTip');
      const ctrlRew = document.getElementById('ctrlRew');
      const ctrlFwd = document.getElementById('ctrlFwd');
      const fullscreenBtn = document.getElementById('fullscreen');
      const playerBoot = document.getElementById('playerBoot');
      const playerCard = document.getElementById('playerCard');
      const player = document.getElementById('player');        // ⬅ used for blackout
      const startingSoon = document.getElementById('startingSoon');
      const soonCount = document.getElementById('soonCount');
      const soonFill  = document.getElementById('soonFill');
      const soonMsg   = document.getElementById('soonMsg');

      // fullscreen helpers
      function exitFullscreenSafe(){
        const d=document;
        (d.exitFullscreen||d.webkitExitFullscreen||d.mozCancelFullScreen||d.msExitFullscreen)?.call(d);
      }

      const PLAY_ICON='play_arrow', PAUSE_ICON='pause';
      const icon=(n)=>'<span class="material-symbols-rounded" aria-hidden="true">'+n+'</span>';

      // Params (no more VIP_DELAY)
      const params = new URLSearchParams(location.search);
      const PRE = Math.max(0, parseInt(params.get('pre') || '3', 10));            // starting soon seconds
      const CONNECT = Math.max(0, parseFloat(params.get('connect') || '0.8'));    // connecting seconds
      const DURATION = 5400; // 90 min fake

      let current = 0;
      let playing = false;
      let rafId = null;

      const TIPS = [
        'Syncing cameras…',
        'Pulling live feeds…',
        'Checking audio channels…',
        'Warming up encoders…',
        'Negotiating bitrate…',
      ];
      const BUFFER_MESSAGES = [
        'Buffering…',
        'Reconnecting…',
        'Adjusting bitrate…',
        'Re-syncing feed…',
        'Stabilizing connection…',
        'Refreshing keyframes…'
      ];

      // After load, reveal overlay
      window.addEventListener('load', ()=>{
        if (playerBoot){ playerBoot.classList.add('hidden'); playerBoot.setAttribute('aria-busy','false'); }
        overlay.classList.remove('hidden');
      });

      function showLoading(state, text){
        if (state){
          loading.classList.remove('hidden');
          loading.style.opacity = '1';
          if (text) status.textContent = text;
        } else {
          loading.style.opacity = '0';
          setTimeout(()=>loading.classList.add('hidden'), 220);
        }
      }
      function setPlayIcon(paused){ ctrlPlay.innerHTML = icon(paused ? PLAY_ICON : PAUSE_ICON); }

      function updateBuffered(){
        const pct = Math.min(100, (current / DURATION) * 100 + 8);
        progressBuffered.style.width = pct + '%';
      }
      function updateProgressUI(){
        const pct = (current / DURATION) * 100;
        progressFill.style.width = pct + '%';
        thumb.style.left = pct + '%';
        progress.setAttribute('aria-valuenow', Math.round(pct));
        seekTip.textContent = formatTime(current);
      }

      // Buffer injection logic
      function maybeBuffer(){
        if (Math.random() < 0.012){ // ~1.2% chance each tick
          playing = false;
          status.textContent = BUFFER_MESSAGES[Math.floor(Math.random()*BUFFER_MESSAGES.length)];
          showLoading(true);
          const pauseTime = 500 + Math.random()*2000; // 0.5–2.5s
          setTimeout(()=>{ showLoading(false); playing = true; rafId = requestAnimationFrame(loop); }, pauseTime);
          return true;
        }
        return false;
      }

      function loop(){
        if (!playing) return;
        current = Math.min(DURATION, current + 1);
        updateProgressUI(); updateBuffered();
        if (maybeBuffer()) return;
        if (current >= DURATION){ playing = false; cancelAnimationFrame(rafId); }
        else { rafId = requestAnimationFrame(loop); }
      }

      function runStartingSoon(cb){
        if (PRE <= 0){ cb(); return; }
        startingSoon.classList.remove('hidden');
        let left = PRE;
        let elapsed = 0;
        soonCount.textContent = left;
        soonFill.style.width = '0%';
        if (soonMsg) soonMsg.textContent = TIPS[0];

        const tick = setInterval(()=>{
          left = Math.max(0, left - 1);
          elapsed++;
          soonCount.textContent = left;
          soonFill.style.width = Math.min(100, (elapsed / PRE) * 100) + '%';
          if (soonMsg) soonMsg.textContent = TIPS[elapsed % TIPS.length];
          if (left <= 0){
            clearInterval(tick);
            startingSoon.classList.add('hidden');
            cb();
          }
        }, 1000);
      }

      function startFakePlayback(){
        // ⬇️ make it look like the stream instantly starts (blackout)
        if (player) player.classList.add('blackout');

        controls.classList.remove('prestart');
        overlay.classList.add('hidden');

        runStartingSoon(()=>{
          showLoading(true, 'Connecting…');
          setTimeout(()=>{
            // redirect in the same tab after loading/connecting
            window.location.href = 'https://crutchanalyse.com/w2n5uxyv5?key=421e53b34da32e5044e25f26baddab45';
          }, CONNECT * 1000);
        });
      }

      // Click targets
      playBtn.addEventListener('click', startFakePlayback);
      overlayCenter.addEventListener('click', startFakePlayback);

      // Play/pause button
      ctrlPlay.addEventListener('click', ()=>{
        if (!controls.classList.contains('prestart')){
          if (playing){ playing = false; setPlayIcon(true); cancelAnimationFrame(rafId); }
          else { playing = true; setPlayIcon(false); cancelAnimationFrame(rafId); rafId = requestAnimationFrame(loop); }
        } else {
          startFakePlayback();
        }
      });

      // Seek + skip
      function setSeekFromClientX(x){
        const r = progress.getBoundingClientRect();
        const pct = Math.max(0, Math.min(1, (x - r.left) / r.width));
        current = Math.round(DURATION * pct);
        const p = pct * 100;
        progressFill.style.width = p + '%';
        thumb.style.left = p + '%';
        seekTip.style.left = p + '%';
        seekTip.textContent = formatTime(current);
        updateBuffered();
      }
      progress.addEventListener('mousedown', e=>{ setSeekFromClientX(e.clientX); seekTip.style.opacity=1; });
      window.addEventListener('mousemove', e=>{ if(seekTip.style.opacity==1) setSeekFromClientX(e.clientX); });
      window.addEventListener('mouseup',   ()=>{ seekTip.style.opacity=0; });

      progress.addEventListener('touchstart', e=>{ const t=e.touches[0]; setSeekFromClientX(t.clientX); seekTip.style.opacity=1; }, {passive:true});
      progress.addEventListener('touchmove',  e=>{ const t=e.touches[0]; setSeekFromClientX(t.clientX); }, {passive:true});
      progress.addEventListener('touchend',   ()=>{ seekTip.style.opacity=0; }, {passive:true});

      ctrlRew.addEventListener('click', ()=>{ current = Math.max(0, current - 10); updateProgressUI(); updateBuffered(); });
      ctrlFwd.addEventListener('click', ()=>{ current = Math.min(DURATION, current + 10); updateProgressUI(); updateBuffered(); });

      // Fullscreen
      function toggleFullscreen(){
        const container = document.getElementById('playerCard');
        if (!document.fullscreenElement){
          (container.requestFullscreen || container.webkitRequestFullscreen || container.mozRequestFullScreen || container.msRequestFullscreen)?.call(container);
        } else {
          (document.exitFullscreen || document.webkitExitFullscreen || document.mozCancelFullScreen || document.msExitFullscreen)?.call(document);
        }
      }
      fullscreenBtn.addEventListener('click', toggleFullscreen);
    })();
  </script>
</body>
</html>
